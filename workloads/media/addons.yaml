globalSelectors:
  cluster_name: media

sonarr:
  enabled: true
  namespace: media
  chartRepository: https://stakater.github.io/stakater-charts
  chartName: application
  defaultVersion: 6.14.0
  ignoreDifferences:
    - group: gateway.networking.k8s.io
      kind: HTTPRoute
      jqPathExpressions:
        - .status
  valuesObject:
    applicationName: sonarr
    extraObjects:
      - apiVersion: v1
        kind: PersistentVolumeClaim
        metadata:
          name: sonarr-config-pvc
          namespace: media
          labels:
            app: sonarr
        spec:
          storageClassName: config-nfs-client
          accessModes:
            - ReadWriteOnce
          resources:
            requests:
              storage: 1Gi
      - apiVersion: v1
        kind: PersistentVolumeClaim
        metadata:
          name: sonarr-media-pvc
          namespace: media
          labels:
            app: sonarr
        spec:
          storageClassName: data-nfs-client
          accessModes:
            - ReadWriteOnce
          resources:
            requests:
              storage: 1Gi
    deployment:
      securityContext:
        runAsUser: 1000
        runAsGroup: 1000
        fsGroup: 1000
      containerSecurityContext:
        runAsNonRoot: true
        runAsUser: 1000
        runAsGroup: 1000
        readOnlyRootFilesystem: false
      image:
        repository: linuxserver/sonarr
        tag: latest
        pullPolicy: IfNotPresent
      ports:
        - name: http
          containerPort: 8989
          protocol: TCP
      env:
        TZ:
          value: America/Denver
        PUID:
          value: "1000"
        PGID:
          value: "1000"
        PUSHOVER_DEBUG:
          value: "false"
        SONARR__AUTHENTICATION_METHOD:
          value: External
        SONARR__AUTHENTICATION_REQUIRED:
          value: DisabledForLocalAddresses
        SONARR__INSTANCE_NAME:
          value: Sonarr
        SONARR__PORT:
          value: "8989"
        SONARR__LOG_LEVEL:
          value: info
        SONARR__THEME:
          value: dark
      additionalContainers:
        - name: exportarr
          image: ghcr.io/onedr0p/exportarr:latest
          command:
            - /exportarr
          args:
            - sonarr
          ports:
            - name: metrics
              containerPort: 9707
              protocol: TCP
          env:
            - name: PORT
              value: "9707"
            - name: URL
              value: http://localhost:8989
            - name: APIKEY
              valueFrom:
                secretKeyRef:
                  name: homepage-secret
                  key: HOMEPAGE_VAR_SONARR_KEY
      volumes:
        config:
          persistentVolumeClaim:
            claimName: sonarr-config-pvc
        media:
          persistentVolumeClaim:
            claimName: sonarr-media-pvc
      volumeMounts:
        config:
          mountPath: /config
        media:
          mountPath: /data
    persistence:
      enabled: false
    service:
      additionalLabels:
        prometheus: media-cluster
      ports:
        - name: http
          port: 8989
          targetPort: 8989
          protocol: TCP
        - name: metrics
          port: 9707
          targetPort: 9707
          protocol: TCP
    serviceMonitor:
      enabled: true
      endpoints:
        - port: metrics
          path: /metrics
          interval: 30s
      additionalLabels:
        prometheus: media-cluster
    httpRoute:
      enabled: true
      parentRefs:
        - name: nginx-gateway
          namespace: nginx-gateway
          sectionName: https-sonarr
      hostnames:
        - sonarr.integratn.tech
      rules:
        - backendRefs:
            - name: sonarr
              port: 8989
          matches:
            - path:
                type: PathPrefix
                value: /
    certificate:
      enabled: true
      secretName: sonarr-tls
      dnsNames:
        - sonarr.integratn.tech
      commonName: sonarr.integratn.tech
      subject: {}
      usages:
        - digital signature
        - key encipherment
        - server auth
      issuerRef:
        name: letsencrypt-prod
        kind: ClusterIssuer
