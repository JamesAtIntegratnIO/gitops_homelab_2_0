# Open WebUI Helm values (chart v12.5.0) — external Ollama, Pipelines enabled
ollama:
  enabled: false

ollamaUrls:
  - "http://10.0.3.4:11434"

# Disable the chart's singular OpenAI URL — we set the plural OPENAI_API_BASE_URLS
# in extraEnvVars to support Pipelines + OpenAI side-by-side.
openaiBaseApiUrl: ""

pipelines:
  enabled: true
  extraEnvVars:
    - name: PIPELINES_URLS
      value: "https://raw.githubusercontent.com/JamesAtIntegratnIO/gitops_homelab_2_0/main/images/git-indexer/rag_pipeline.py"

image:
  tag: ""  # Use chart default

resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    memory: 1Gi

persistence:
  enabled: true
  size: 2Gi
  storageClass: config-nfs-client
  accessModes:
    - ReadWriteOnce

ingress:
  enabled: false

# Native Gateway API HTTPRoute (new in chart v12+)
route:
  enabled: true
  apiVersion: gateway.networking.k8s.io/v1
  kind: HTTPRoute
  hostnames:
    - "chat.cluster.integratn.tech"
  parentRefs:
    - name: nginx-gateway
      namespace: nginx-gateway
      sectionName: https
  httpsRedirect: false

# Disable websocket redis (single replica, not needed)
websocket:
  enabled: false

extraEnvVars:
  - name: WEBUI_SECRET_KEY
    valueFrom:
      secretKeyRef:
        name: open-webui-secrets
        key: secret-key
  # OpenAI API (ChatGPT) — key from 1Password via ExternalSecret
  # Defined early so $(OPENAI_API_KEY_OPENAI) can be expanded below.
  - name: OPENAI_API_KEY_OPENAI
    valueFrom:
      secretKeyRef:
        name: open-webui-secrets
        key: openai-api-key
  # Both Pipelines (local RAG) and OpenAI (ChatGPT) as OpenAI-compatible backends
  - name: OPENAI_API_BASE_URLS
    value: "http://open-webui-pipelines:9099;https://api.openai.com/v1"
  - name: OPENAI_API_KEYS
    value: "0p3n-w3bu!;$(OPENAI_API_KEY_OPENAI)"
  # OIDC / Authentik SSO
  - name: ENABLE_OAUTH_SIGNUP
    value: "true"
  - name: OAUTH_PROVIDER_NAME
    value: "Authentik"
  - name: OPENID_PROVIDER_URL
    value: "https://auth.cluster.integratn.tech/application/o/open-webui/.well-known/openid-configuration"
  - name: OAUTH_CLIENT_ID
    valueFrom:
      secretKeyRef:
        name: open-webui-secrets
        key: oidc-client-id
  - name: OAUTH_CLIENT_SECRET
    valueFrom:
      secretKeyRef:
        name: open-webui-secrets
        key: oidc-client-secret
  - name: OAUTH_SCOPES
    value: "openid email profile groups"
  - name: ENABLE_OAUTH_ROLE_MANAGEMENT
    value: "true"
  - name: OAUTH_ADMIN_ROLES
    value: "authentik Admins"
  - name: OAUTH_ALLOWED_ROLES
    value: "authentik Admins,open-webui-users"
  # Disable local signup — SSO only
  - name: ENABLE_SIGNUP
    value: "false"
  - name: ENABLE_LOGIN_FORM
    value: "true"
  - name: DEFAULT_USER_ROLE
    value: "user"
  # Enable API keys for programmatic access
  - name: ENABLE_API_KEY
    value: "true"
  # Filter chat model list — allowlist only (hides embedding-only models like nomic-embed-text)
  - name: ENABLE_MODEL_FILTER
    value: "true"
  - name: MODEL_FILTER_LIST
    value: "qwen3:4b;llama3.2:latest;llama3.1:latest;mistral:7b;gpt-4o;gpt-4o-mini;gpt-4.1;gpt-4.1-mini;gpt-4.1-nano;gpt-5.2;gpt-5.2-pro;gpt-5.2-with-tools"
  - name: DEFAULT_MODELS
    value: "gpt-5.2-with-tools"
  # RAG settings
  - name: ENABLE_RAG_WEB_SEARCH
    value: "false"
  - name: RAG_EMBEDDING_ENGINE
    value: "ollama"
  - name: RAG_EMBEDDING_MODEL
    value: "nomic-embed-text"
  - name: RAG_OPENAI_API_BASE_URL
    value: "http://10.0.3.4:11434"
