# Kratix Values for control-plane clusters

# Additional Kratix resources
additionalResources:
  # ExternalSecret for GitHub App authentication
  - apiVersion: external-secrets.io/v1beta1
    kind: ExternalSecret
    metadata:
      name: kratix-github-credentials
      namespace: kratix-platform-system
    spec:
      secretStoreRef:
        name: onepassword-connect
        kind: ClusterSecretStore
      target:
        name: kratix-github-credentials
        creationPolicy: Owner
      data:
        - secretKey: appID
          remoteRef:
            key: kratix-gitops-statestore
            property: AppID
        - secretKey: installationID
          remoteRef:
            key: kratix-gitops-statestore
            property: InstallID
        - secretKey: privateKey
          remoteRef:
            key: kratix-gitops-statestore
            property: PrivateKey

  # GitStateStore for kratix-platform-state repository
  - apiVersion: platform.kratix.io/v1alpha1
    kind: GitStateStore
    metadata:
      name: default
      namespace: kratix-platform-system
    spec:
      authMethod: githubApp
      secretRef:
        name: kratix-github-credentials
        namespace: kratix-platform-system
      url: https://github.com/jamesatintegratnio/kratix-platform-state
      branch: main
      path: clusters

  # Destination for the-cluster
  - apiVersion: platform.kratix.io/v1alpha1
    kind: Destination
    metadata:
      name: the-cluster
      namespace: kratix-platform-system
    spec:
      stateStoreRef:
        name: default
        kind: GitStateStore
      path: the-cluster
      strictMatchLabels: false
      labels:
        environment: production
        cluster-role: control-plane
        capability.vcluster: "true"
