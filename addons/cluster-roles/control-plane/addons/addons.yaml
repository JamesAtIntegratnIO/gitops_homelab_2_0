kratix:
  enabled: true
  namespace: kratix-platform-system
  chartName: kratix
  project: platform
  chartRepository: https://syntasso.github.io/helm-charts
  defaultVersion: "0.0.1"
  selector:
    matchExpressions:
      - key: enable_kratix
        operator: In
        values: ['true']
  syncPolicy:
    automated:
      selfHeal: true
      allowEmpty: true
      prune: true

kratix-promises:
  enabled: true
  type: manifest
  namespace: default
  project: platform
  defaultVersion: "main"
  selector:
    matchExpressions:
      - key: enable_kratix
        operator: In
        values: ['true']
  manifestSource:
    repoURL: https://github.com/jamesatintegratnio/gitops_homelab_2_0.git
    targetRevision: main
    path: promises
    directory:
      recurse: true
      exclude: _archived/**,vcluster-orchestrator-v2/workflows/**,**/templates/**
  syncPolicy:
    automated:
      selfHeal: true
      prune: true
    syncOptions:
      - CreateNamespace=false
  info:
    - name: Description
      value: Automatically installs all Kratix Promises from the promises/ directory

platform-vclusters:
  enabled: true
  type: manifest
  namespace: platform-requests
  project: platform
  defaultVersion: "main"
  selector:
    matchExpressions:
      - key: enable_kratix
        operator: In
        values: ['true']
  manifestSource:
    repoURL: https://github.com/jamesatintegratnio/gitops_homelab_2_0.git
    targetRevision: main
    path: platform/vclusters
    directory:
      recurse: true
  syncPolicy:
    automated:
      selfHeal: true
      prune: true
    syncOptions:
      - CreateNamespace=true
  info:
    - name: Description
      value: Kratix ResourceRequests for vCluster provisioning

observability-secrets:
  enabled: true
  type: manifest
  namespace: monitoring
  project: platform-services
  defaultVersion: "main"
  path: addons/cluster-roles/control-plane/addons/observability-secrets
  selector:
    matchExpressions:
      - key: cluster_role
        operator: NotIn
        values: ['vcluster']
  syncPolicy:
    automated:
      selfHeal: true
      prune: true
    syncOptions:
      - CreateNamespace=true

matrix-alertmanager-receiver:
  enabled: true
  type: manifest
  namespace: monitoring
  project: platform-services
  defaultVersion: "main"
  path: addons/cluster-roles/control-plane/addons/matrix-alertmanager-receiver
  selector:
    matchExpressions:
      - key: cluster_role
        operator: NotIn
        values: ['vcluster']
  syncPolicy:
    automated:
      selfHeal: true
      prune: true
    syncOptions:
      - CreateNamespace=true

vcluster-dashboard:
  enabled: true
  type: manifest
  namespace: monitoring
  project: platform-services
  defaultVersion: "main"
  path: addons/cluster-roles/control-plane/addons/vcluster-dashboard
  selector:
    matchExpressions:
      - key: cluster_role
        operator: NotIn
        values: ['vcluster']
  syncPolicy:
    automated:
      selfHeal: true
      prune: true
    syncOptions:
      - CreateNamespace=true

argocd-dashboard:
  enabled: true
  type: manifest
  namespace: monitoring
  project: platform-services
  defaultVersion: "main"
  path: addons/cluster-roles/control-plane/addons/argocd-dashboard
  selector:
    matchExpressions:
      - key: cluster_role
        operator: NotIn
        values: ['vcluster']
  syncPolicy:
    automated:
      selfHeal: true
      prune: true
    syncOptions:
      - CreateNamespace=true

loki-dashboard:
  enabled: true
  type: manifest
  namespace: monitoring
  project: platform-services
  defaultVersion: "main"
  path: addons/cluster-roles/control-plane/addons/loki-dashboard
  selector:
    matchExpressions:
      - key: cluster_role
        operator: NotIn
        values: ['vcluster']
  syncPolicy:
    automated:
      selfHeal: true
      prune: true
    syncOptions:
      - CreateNamespace=true

kratix-dashboard:
  enabled: true
  type: manifest
  namespace: monitoring
  project: platform-services
  defaultVersion: "main"
  path: addons/cluster-roles/control-plane/addons/kratix-dashboard
  selector:
    matchExpressions:
      - key: cluster_role
        operator: NotIn
        values: ['vcluster']
  syncPolicy:
    automated:
      selfHeal: true
      prune: true
    syncOptions:
      - CreateNamespace=true

platform-landing-zone:
  enabled: true
  type: manifest
  namespace: monitoring
  project: platform-services
  defaultVersion: "main"
  path: addons/cluster-roles/control-plane/addons/platform-landing-zone
  selector:
    matchExpressions:
      - key: cluster_role
        operator: NotIn
        values: ['vcluster']
  syncPolicy:
    automated:
      selfHeal: true
      prune: true
    syncOptions:
      - CreateNamespace=true

network-policies:
  enabled: true
  type: manifest
  namespace: default
  project: platform-services
  defaultVersion: "main"
  path: addons/cluster-roles/control-plane/addons/network-policies
  selector:
    matchExpressions:
      - key: cluster_role
        operator: NotIn
        values: ['vcluster']
  syncPolicy:
    automated:
      selfHeal: true
      prune: true
    syncOptions:
      - ServerSideApply=true
      - RespectIgnoreDifferences=true
  ignoreDifferences:
    - group: kyverno.io
      kind: ClusterPolicy
      jqPathExpressions:
        - .metadata.annotations."policies.kyverno.io/rescan"

authentik:
  enabled: true
  namespace: authentik
  releaseName: authentik
  chartName: authentik
  project: platform-services
  chartRepository: https://charts.goauthentik.io
  defaultVersion: "2025.12.4"
  selector:
    matchExpressions:
      - key: cluster_role
        operator: NotIn
        values: ['vcluster']
  ignoreDifferences:
    - group: external-secrets.io
      kind: ExternalSecret
      jqPathExpressions:
        - .spec.target.deletionPolicy
        - .spec.data[]?.remoteRef.conversionStrategy
        - .spec.data[]?.remoteRef.decodingStrategy
        - .spec.data[]?.remoteRef.metadataPolicy
    - group: gateway.networking.k8s.io
      kind: HTTPRoute
      jqPathExpressions:
        - .spec.parentRefs[]?.group
        - .spec.parentRefs[]?.kind
        - .spec.rules[]?.backendRefs[]?.group
        - .spec.rules[]?.backendRefs[]?.kind
        - .spec.rules[]?.backendRefs[]?.weight
  syncPolicy:
    automated:
      selfHeal: true
      prune: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
      - RespectIgnoreDifferences=true

kube-prometheus-stack:
  enabled: true
  namespace: monitoring
  releaseName: kube-prometheus-stack
  chartName: kube-prometheus-stack
  project: platform-services
  chartRepository: https://prometheus-community.github.io/helm-charts
  defaultVersion: "82.1.1"
  selector:
    matchExpressions:
      - key: cluster_role
        operator: NotIn
        values: ['vcluster']
  syncPolicy:
    automated:
      selfHeal: true
      prune: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true

kube-prometheus-stack-extras:
  enabled: true
  type: manifest
  namespace: monitoring
  project: platform-services
  defaultVersion: "main"
  path: addons/cluster-roles/control-plane/addons/kube-prometheus-stack-extras
  selector:
    matchExpressions:
      - key: cluster_role
        operator: NotIn
        values: ['vcluster']
  syncPolicy:
    automated:
      selfHeal: true
      prune: true
    syncOptions:
      - CreateNamespace=true
  info:
    - name: Description
      value: Extra raw manifests for kube-prometheus-stack (etcd cert extraction, etc.)

loki:
  enabled: true
  namespace: loki
  releaseName: loki
  chartName: loki
  project: platform-services
  chartRepository: https://grafana.github.io/helm-charts
  defaultVersion: "6.49.0"
  selector:
    matchExpressions:
      - key: cluster_role
        operator: NotIn
        values: ['vcluster']
  annotations:
    argocd.argoproj.io/compare-options: ServerSideDiff=true
  ignoreDifferences:
    - group: apps
      kind: StatefulSet
      jsonPointers:
        - /spec/volumeClaimTemplates/0/metadata/creationTimestamp
        - /spec/volumeClaimTemplates/0/status
  syncPolicy:
    automated:
      selfHeal: true
      prune: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
      - RespectIgnoreDifferences=true

promtail:
  enabled: true
  namespace: promtail
  releaseName: promtail
  chartName: promtail
  project: platform-services
  chartRepository: https://grafana.github.io/helm-charts
  defaultVersion: "6.9.0"
  selector:
    matchExpressions:
      - key: cluster_role
        operator: NotIn
        values: ['vcluster']
  syncPolicy:
    automated:
      selfHeal: true
      prune: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true

goldilocks:
  enabled: true
  namespace: goldilocks
  releaseName: goldilocks
  chartName: goldilocks
  project: platform-services
  chartRepository: https://charts.fairwinds.com/stable
  defaultVersion: "10.2.0"
  selector:
    matchExpressions:
      - key: cluster_role
        operator: NotIn
        values: ['vcluster']
  ignoreDifferences:
    - group: gateway.networking.k8s.io
      kind: HTTPRoute
      jqPathExpressions:
        - .spec.parentRefs[]?.group
        - .spec.parentRefs[]?.kind
        - .spec.rules[]?.backendRefs[]?.group
        - .spec.rules[]?.backendRefs[]?.kind
        - .spec.rules[]?.backendRefs[]?.weight
  syncPolicy:
    automated:
      selfHeal: true
      prune: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
      - RespectIgnoreDifferences=true

trivy-operator:
  enabled: true
  namespace: trivy-system
  releaseName: trivy-operator
  chartName: trivy-operator
  project: platform-services
  chartRepository: https://aquasecurity.github.io/helm-charts/
  defaultVersion: "0.32.0"
  selector:
    matchExpressions:
      - key: cluster_role
        operator: NotIn
        values: ['vcluster']
  syncPolicy:
    automated:
      selfHeal: true
      prune: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
    managedNamespaceMetadata:
      labels:
        pod-security.kubernetes.io/enforce: privileged
        pod-security.kubernetes.io/enforce-version: latest
        pod-security.kubernetes.io/audit: privileged
        pod-security.kubernetes.io/warn: privileged

trivy-dashboard:
  enabled: true
  type: manifest
  namespace: monitoring
  project: platform-services
  defaultVersion: "main"
  path: addons/cluster-roles/control-plane/addons/trivy-dashboard
  selector:
    matchExpressions:
      - key: cluster_role
        operator: NotIn
        values: ['vcluster']
  syncPolicy:
    automated:
      selfHeal: true
      prune: true
    syncOptions:
      - CreateNamespace=true

trivy-explorer:
  enabled: true
  namespace: trivy-system
  releaseName: trivy-operator-explorer
  chartName: trivy-operator-explorer
  project: platform-services
  chartRepository: https://starttoaster.github.io/trivy-operator-explorer
  defaultVersion: "0.4.6"
  selector:
    matchExpressions:
      - key: cluster_role
        operator: NotIn
        values: ['vcluster']
  syncPolicy:
    automated:
      selfHeal: true
      prune: true
    syncOptions:
      - CreateNamespace=true

trivy-explorer-route:
  enabled: true
  type: manifest
  namespace: trivy-system
  project: platform-services
  defaultVersion: "main"
  path: addons/cluster-roles/control-plane/addons/trivy-explorer-route
  selector:
    matchExpressions:
      - key: cluster_role
        operator: NotIn
        values: ['vcluster']
  syncPolicy:
    automated:
      selfHeal: true
      prune: true
    syncOptions:
      - CreateNamespace=true

# ── AI Platform Stack ──────────────────────────────────────────────
qdrant:
  enabled: true
  namespace: ai
  chartName: qdrant
  chartRepository: "https://qdrant.github.io/qdrant-helm"
  defaultVersion: "1.17.0"
  project: platform-services
  selector:
    matchExpressions:
      - key: cluster_role
        operator: NotIn
        values: ['vcluster']
  syncPolicy:
    automated:
      selfHeal: true
      prune: true
    syncOptions:
      - CreateNamespace=true

open-webui:
  enabled: true
  namespace: ai
  chartName: open-webui
  chartRepository: "https://helm.openwebui.com/"
  defaultVersion: "12.5.0"
  project: platform-services
  selector:
    matchExpressions:
      - key: cluster_role
        operator: NotIn
        values: ['vcluster']
  syncPolicy:
    automated:
      selfHeal: true
      prune: true
    syncOptions:
      - CreateNamespace=true

ai-platform:
  enabled: true
  type: manifest
  namespace: ai
  project: platform-services
  defaultVersion: "main"
  path: addons/cluster-roles/control-plane/addons/ai-platform
  selector:
    matchExpressions:
      - key: cluster_role
        operator: NotIn
        values: ['vcluster']
  syncPolicy:
    automated:
      selfHeal: true
      prune: true
    syncOptions:
      - CreateNamespace=true

platform-status-reconciler:
  enabled: true
  type: manifest
  namespace: platform-status-reconciler
  project: platform
  defaultVersion: "main"
  path: addons/cluster-roles/control-plane/addons/platform-status-reconciler
  selector:
    matchExpressions:
      - key: enable_kratix
        operator: In
        values: ['true']
  syncPolicy:
    automated:
      selfHeal: true
      prune: true
    syncOptions:
      - CreateNamespace=true
