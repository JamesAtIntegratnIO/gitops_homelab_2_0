# Authentik Blueprint: Google OAuth Source
# Configures Google as a social login / federation source
# Callback URL to configure in Google Cloud Console:
#   https://auth.cluster.integratn.tech/source/oauth/callback/google/
version: 1
metadata:
  name: google-oauth-source
  labels:
    blueprints.goauthentik.io/instantiate: "true"
context:
  google_client_id: !Env GOOGLE_CLIENT_ID
  google_client_secret: !Env GOOGLE_CLIENT_SECRET
entries:
  # Google OAuth Source
  - model: authentik_sources_oauth.oauthsource
    identifiers:
      slug: google
    id: google-source
    attrs:
      name: Google
      provider_type: google
      consumer_key: !Context google_client_id
      consumer_secret: !Context google_client_secret
      authentication_flow: !Find [authentik_flows.flow, [slug, default-authentication-flow]]
      enrollment_flow: !Find [authentik_flows.flow, [slug, default-source-enrollment]]
      user_matching_mode: email_link
      enabled: true
      oidc_well_known_url: "https://accounts.google.com/.well-known/openid-configuration"
      oidc_jwks_url: "https://www.googleapis.com/oauth2/v3/certs"
      additional_scopes: ""
