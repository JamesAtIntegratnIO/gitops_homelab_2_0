applicationName: sonarr
extraObjects:
  - apiVersion: external-secrets.io/v1beta1
    kind: ExternalSecret
    metadata:
      name: eso-homepage-secret
      namespace: media
    spec:
      refreshInterval: 1h
      secretStoreRef:
        kind: ClusterSecretStore
        name: onepassword-store
      target:
        name: homepage-secret
        creationPolicy: Owner
      dataFrom:
        - extract:
            key: homepage-secret
            decodingStrategy: None
            conversionStrategy: Default
            metadataPolicy: None
  - apiVersion: v1
    kind: PersistentVolume
    metadata:
      name: sonarr-config-pv
      labels:
        app: sonarr
      annotations:
        pv.kubernetes.io/provisioned-by: k8s-sigs.io/nfs-subdir-external-provisioner
    spec:
      accessModes:
        - ReadWriteOnce
      capacity:
        storage: 1Gi
      nfs:
        path: /mnt/user/kube_storage/sonarr-config-pvc
        server: 10.0.0.12
      persistentVolumeReclaimPolicy: Retain
      storageClassName: config-nfs-client
      volumeMode: Filesystem
  - apiVersion: v1
    kind: PersistentVolumeClaim
    metadata:
      name: sonarr-config-pvc
      namespace: media
      labels:
        app: sonarr
    spec:
      storageClassName: config-nfs-client
      accessModes:
        - ReadWriteOnce
      resources:
        requests:
          storage: 1Gi
      volumeName: sonarr-config-pv
  - apiVersion: v1
    kind: PersistentVolume
    metadata:
      name: sonarr-media-pv
      labels:
        app: sonarr
      annotations:
        pv.kubernetes.io/provisioned-by: k8s-sigs.io/data-nfs-subdir-external-provisioner
    spec:
      accessModes:
        - ReadWriteOnce
      capacity:
        storage: 1Gi
      nfs:
        path: /mnt/user/data
        server: 10.0.0.12
      persistentVolumeReclaimPolicy: Retain
      storageClassName: data-nfs-client
      volumeMode: Filesystem
  - apiVersion: v1
    kind: PersistentVolumeClaim
    metadata:
      name: sonarr-media-pvc
      namespace: media
      labels:
        app: sonarr
    spec:
      storageClassName: data-nfs-client
      accessModes:
        - ReadWriteOnce
      resources:
        requests:
          storage: 1Gi
      volumeName: sonarr-media-pv
deployment:
  securityContext:
    fsGroup: 1000
    seccompProfile:
      type: RuntimeDefault
  containerSecurityContext:
    runAsNonRoot: false
    runAsUser: 0
    readOnlyRootFilesystem: true
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
      add:
        - CHOWN
        - DAC_OVERRIDE
        - FOWNER
        - SETUID
        - SETGID
  image:
    repository: linuxserver/sonarr
    tag: latest
    pullPolicy: IfNotPresent
  ports:
    - name: http
      containerPort: 8989
      protocol: TCP
  env:
    TZ:
      value: America/Denver
    PUID:
      value: "1000"
    PGID:
      value: "1000"
    PUSHOVER_DEBUG:
      value: "false"
    SONARR__AUTHENTICATION_METHOD:
      value: External
    SONARR__AUTHENTICATION_REQUIRED:
      value: DisabledForLocalAddresses
    SONARR__INSTANCE_NAME:
      value: Sonarr
    SONARR__PORT:
      value: "8989"
    SONARR__LOG_LEVEL:
      value: info
    SONARR__THEME:
      value: dark
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      memory: 512Mi
  additionalContainers:
    - name: exportarr
      image: ghcr.io/onedr0p/exportarr:v2.3.0
      command:
        - /exportarr
      args:
        - sonarr
      ports:
        - name: metrics
          containerPort: 9707
          protocol: TCP
      env:
        - name: PORT
          value: "9707"
        - name: URL
          value: http://localhost:8989
        - name: APIKEY
          valueFrom:
            secretKeyRef:
              name: homepage-secret
              key: HOMEPAGE_VAR_SONARR_KEY
      securityContext:
        runAsNonRoot: true
        runAsUser: 65534
        readOnlyRootFilesystem: true
        allowPrivilegeEscalation: false
        capabilities:
          drop:
            - ALL
      resources:
        requests:
          cpu: 10m
          memory: 32Mi
        limits:
          memory: 64Mi
  volumes:
    config:
      persistentVolumeClaim:
        claimName: sonarr-config-pvc
    media:
      persistentVolumeClaim:
        claimName: sonarr-media-pvc
    tmp:
      emptyDir:
        medium: Memory
        sizeLimit: 64Mi
    s6-run:
      emptyDir:
        medium: Memory
        sizeLimit: 16Mi
  volumeMounts:
    config:
      mountPath: /config
    media:
      mountPath: /data
    tmp:
      mountPath: /tmp
    s6-run:
      mountPath: /run
persistence:
  enabled: false
service:
  additionalLabels:
    prometheus: media-cluster
  ports:
    - name: http
      port: 8989
      targetPort: 8989
      protocol: TCP
serviceMonitor:
  enabled: false
httpRoute:
  enabled: true
  parentRefs:
    - name: nginx-gateway
      namespace: nginx-gateway
      sectionName: https
  hostnames:
    - sonarr.vcluster-media.integratn.tech
  rules:
    - backendRefs:
        - name: sonarr
          port: 8989
      matches:
        - path:
            type: PathPrefix
            value: /
certificate:
  enabled: false
